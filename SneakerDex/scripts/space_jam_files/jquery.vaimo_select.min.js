/* ===========================================================
 *
 *  Name:          jquery.vaimo_select.min.js
 *  Created:       2013-03-11
 *  Updated:       2013-03-15
 *  Version:       0.1.1
 *  Updated by:    Per
 *  Created by:    Per @ Vaimo
 *
 *  Released under the MIT License:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Vaimo | Beard, Rock & Loud Guns
 * =========================================================== */


(function(a){a.fn.vaimoSelect=function(b){var e,f,c=a.extend({},{vsID:!1,vsClass:!1,vsPlaceholder:!1,vsPrefix:!1,vsCycle:!1,vsMobile:!0,vsCallback:function(){}},b),d=navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry)/),g=function(){var m,n,e=a(this).attr("title"),f=a("option:selected",this).text(),g=a(this).is(":disabled"),i="";c.vsPrefix?i+='<span class="prefix">'+c.vsPrefix+"</span> ":a(this).data("prefix")&&(i+='<span class="prefix">'+a(this).data("prefix")+"</span> "),i+=c.vsPlaceholder?'<span class="label placeholder">'+c.vsPlaceholder+"</span>":a(this).data("placeholder")?'<span class="label placeholder">'+a(this).data("placeholder")+"</span>":'<span class="label">'+f+"</span>",a("<div/>",{id:c.vsID?c.vsID:"","class":g?"vaimo_select disabled":"vaimo_select",title:e,tabindex:0,html:i}).insertAfter(this),m=a(this).next(".vaimo_select"),c.vsClass?m.addClass(c.vsClass):"",d&&c.vsMobile&&m.addClass("mobile"),a("<ul/>").appendTo(m),n=a(m).find("ul"),a("option, optgroup",this).each(function(){var c=a(this).text(),d=a(this).is(":selected"),e=a(this).is(":disabled"),f=a(this).parent().is("optgroup");a(this).is("option")?(a("<li/>",{"class":d?"selected":e?"disabled":"",text:c}).appendTo(n),f&&a(n).find("li:last").addClass("groupchild")):a("<li/>",{"class":"optgroup",text:a(this).attr("label")}).appendTo(n)}),a(this).appendTo(m),a(this).parent(".vaimo_select").on("focus",h).on("click","li",j).on("keydown",l).on("blur",k)},h=function(){e=a(this),f=a(this).find("li").filter(".selected"),a(this).find("li").filter(".selected").addClass("focused")},i=function(){var d=a(this).closest(".vaimo_select"),e=a(":selected",this).text();a(":selected",this).index(),d.find(".label").html(e).removeClass("placeholder"),c.vsCallback.call(this)},j=function(){var d=a(this).text(),e=a(this).closest(".vaimo_select"),f=a(this).hasClass("disabled"),g=a(this).hasClass("optgroup"),h=e.find("li:not('.optgroup')").index(this);f||g||(e.find(".label").html(d).removeClass("placeholder"),e.find(".selected").removeClass("selected"),e.find("select option")[h].selected=!0,e.find(".focused").removeClass("focused"),e.blur(),a(this).addClass("selected"),c.vsCallback.call(this))},k=function(){var a=e.find("li").filter(".focused"),b=e.find("li").filter(".selected");a.length&&!b.length&&(a.removeClass("focused"),f.addClass("selected"))},l=function(b){var g,h,d=a(this).find("li"),e=d.filter(".selected"),f=d.filter(".focused");return e.length||f.length?e.addClass("focused").removeClass("selected"):d.eq(0).addClass("focused"),38==b.keyCode?(g=f.prevAll(":not('.disabled, .optgroup')").first(),h=d.not(".disabled, .optgroup").last()):40==b.keyCode&&(g=f.nextAll(":not('.disabled, .optgroup')").first(),h=d.not(".disabled, .optgroup").first()),38==b.keyCode||40==b.keyCode?(g.is("li")?(f.removeClass("focused"),g.addClass("focused")):c.vsCycle&&(f.removeClass("focused"),h.addClass("focused")),!1):(13==b.keyCode?f.trigger("click"):27==b.keyCode&&a(this).blur(),void 0)};return this.each(function(){a(this).each(g),a(this).on("change",i)})}})(jQuery);